"use strict";var S=Object.defineProperty;var y=(s,e,t)=>e in s?S(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var a=(s,e,t)=>(y(s,typeof e!="symbol"?e+"":e,t),t);var p=(s,e,t)=>new Promise((n,i)=>{var l=o=>{try{r(t.next(o))}catch(h){i(h)}},d=o=>{try{r(t.throw(o))}catch(h){i(h)}},r=o=>o.done?n(o.value):Promise.resolve(o.value).then(l,d);r((t=t.apply(s,e)).next())});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const b=(s,e=500)=>{let t;return(...n)=>{clearTimeout(t),t=setTimeout(()=>{s.apply(void 0,n)},e)}},L=(s,e)=>{document.addEventListener("click",t=>{t.currentTarget!==s&&!s.contains(t.target)&&e()})},O=(s,e)=>{const t=e.toLowerCase().split(" ");return s.filter(n=>t.every(i=>n.label.toLowerCase().includes(i)))},u="https://api.novaposhta.ua/v2.0/json/";class C{constructor(e){a(this,"API_URL");this.config=e,this.API_URL=u}getNpCities(e){return p(this,null,function*(){try{const t=yield fetch(this.API_URL,this.getConfig({modelName:"Address",calledMethod:"searchSettlements",methodProperties:{CityName:e,Limit:"30"}})),{data:n}=yield t.json();return n[0].Addresses}catch(t){return[]}})}getNpWarehouses(e){return p(this,null,function*(){try{const t=yield fetch(u,this.getConfig({modelName:"Address",calledMethod:"getWarehouses",methodProperties:{CityName:e}})),{data:n}=yield t.json();return n}catch(t){return[]}})}getConfig(e){return{body:JSON.stringify({apiKey:this.config.apiKey,modelName:e.modelName,calledMethod:e.calledMethod,methodProperties:e.methodProperties}),method:"POST"}}}const w=["Enter"],m={option:"np-select__option"},E='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 13 7"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.5 7a.956.956 0 01-.657-.256l-5.57-5.25a.839.839 0 010-1.237.968.968 0 011.312 0L6.5 4.888 11.415.257a.968.968 0 011.313 0 .839.839 0 010 1.237l-5.572 5.25A.956.956 0 016.5 7z"/></svg>',N='<span class="spinner"><span></span><span></span><span></span><span></span></span>';class ${constructor({root:e,button:t,input:n,options:i=[],getOption:l,onSelect:d=()=>{},onInput:r=()=>{},onOpen:o=()=>{},onMounted:h=()=>{},apiKey:v}){a(this,"options");a(this,"filtered");a(this,"open");a(this,"value");a(this,"button");a(this,"input");a(this,"placeholder");a(this,"selected");a(this,"disabled");a(this,"loading");a(this,"$root");a(this,"$wrapper");a(this,"$button");a(this,"$input");a(this,"$select");a(this,"$placeholder");a(this,"getOption");a(this,"onSelect");a(this,"onInput");a(this,"onOpen");a(this,"onMounted");a(this,"api");this.options=i.map(c=>l(c)),this.filtered=i.map(c=>l(c)),this.open=!1,this.value="",this.selected="",this.button=t,this.input=n,this.disabled=!1,this.loading=!1,this.$root=e,this.$wrapper=null,this.$button=null,this.$input=null,this.$select=null,this.$placeholder=null,this.getOption=l,this.onSelect=d,this.onInput=r,this.onOpen=o,this.onMounted=h,this.api=new C({apiKey:v}),this.build()}validate(){const e=!!this.selected;return this.disabled?!1:(this.$wrapper.ariaInvalid=`${!e}`,e)}setLoading(e){this.loading=e,this.$wrapper.ariaBusy=`${e}`}getLoading(){return this.loading}setSelected(e){this.selected=e,this.setValue(e)}getSelected(){return{value:this.selected,option:this.options.find(e=>e.value===this.selected)}}setValue(e=""){if(!e.length){this.selected="";return}this.filtered.some(t=>t.value===e)&&(this.selected=e,this.setButtonText(this.selected)),this.value=e,this.$input.value=e,this.createSelectOptions()}getValue(){return this.value}setOptions(e){this.options=e.map(t=>this.getOption(t)),this.filtered=e.map(t=>this.getOption(t)),this.setEmptyState(this.filtered),this.createSelectOptions()}getOptions(){return this.options}setFiltered(e){this.filtered=e,this.setEmptyState(this.filtered),this.createSelectOptions()}getFiltered(){return this.filtered}setOpen(e){e?this.handleOpen():this.handleClose(),this.open=e}setDisabled(e){this.disabled=e,this.$button.disabled=e,this.setButtonText(this.button.text||""),this.$wrapper.ariaDisabled=`${e}`}build(){var t;const e=this.createSelect();this.options&&this.createSelectOptions(),this.$wrapper=e,this.$root.replaceChildren(e),(t=this.onMounted)==null||t.call(this,this),L(this.$root,()=>this.setOpen(!1))}createSelect(){var r;const e=document.createElement("div");e.classList.add("np-select");const t=this.createButton();this.$button=t,e.appendChild(t);const n=document.createElement("input");n.classList.add("np-select__input"),n.name=this.input.name||"",n.placeholder=this.input.placeholder||"",n.autocomplete="off";const i=b(o=>this.handleInput(o));n.addEventListener("input",i),n.addEventListener("keydown",o=>{o.code==="ArrowDown"&&this.$select.querySelector(m.option).focus()}),e.appendChild(n),this.$input=n;const l=document.createElement("div");l.classList.add("np-select__box","empty"),e.append(l),this.$select=l;const d=document.createElement("div");return d.classList.add("np-select__placeholder"),d.textContent=((r=this.placeholder)==null?void 0:r.text)||"Nothing found.",e.append(d),this.$placeholder=d,e}createSelectOptions(){this.$select.replaceChildren(),this.filtered.forEach(e=>{const t=document.createElement("div");t.classList.add("np-select__option"),t.textContent=e.label,t.tabIndex=0,e.value===this.value&&t.classList.add("selected"),t.addEventListener("click",()=>this.handleSelect(t,e)),t.addEventListener("keydown",n=>{w.includes(n.code)&&this.handleSelect(t,e)}),this.$select.appendChild(t)})}createButton(){const e=document.createElement("button");e.classList.add("np-select__button"),e.type="button",e.addEventListener("click",()=>{this.open?this.handleClose():this.handleOpen()});const t=document.createElement("span");t.classList.add("text"),t.textContent=this.button.text||"",e.appendChild(t);const n=document.createElement("span");n.classList.add("icon"),n.innerHTML=E,e.appendChild(n);const i=document.createElement("span");return i.classList.add("loading"),i.innerHTML=N,e.appendChild(i),e}setButtonText(e){const t=this.$button.querySelector("span.text");t.textContent=e}setEmptyState(e){e.length?(this.$select.classList.remove("empty"),this.$placeholder.classList.remove("empty")):(this.$select.classList.add("empty"),this.$placeholder.classList.add("empty"))}handleOpen(){var t;((t=this.onOpen)==null?void 0:t.call(this,this))===!1&&this.setDisabled(!0),!this.disabled&&(this.$wrapper.classList.add("open"),this.$input.focus(),this.open=!0)}handleClose(){this.$wrapper.classList.remove("open"),this.open=!1}handleSelect(e,t){var n;this.$root.querySelectorAll(m.option).forEach(i=>i.classList.remove("selected")),e.classList.add("selected"),this.handleClose(),this.setButtonText(t.label),this.selected=t.value,this.value=t.value,this.$input.value=t.value,(n=this.onSelect)==null||n.call(this,t,this),this.validate()}handleInput(e){var n;const t=e.target.value;(n=this.onInput)==null||n.call(this,t,this),this.value=t,this.selected!==t&&(this.selected="",this.createSelectOptions())}}const x=s=>({label:s.Present,value:s.MainDescription}),_=s=>{var t;const e=s.getOption||x;return new $({root:s.root,apiKey:s.apiKey,button:{text:s.button.text},input:{name:s.input.name,placeholder:s.input.placeholder},placeholder:{text:((t=s==null?void 0:s.placeholder)==null?void 0:t.text)||"Не знайдено відділень, спробуйте вибрати інше місто."},onMounted:s.onMounted,onSelect:(n,i)=>p(exports,null,function*(){var l;i.setSelected(n.value),(l=s.onSelect)==null||l.call(s,n,i)}),onInput:(n,i)=>p(exports,null,function*(){if(n.length>=3){i.setLoading(!0);const l=yield i.api.getNpCities(n);i.setOptions(l),i.setLoading(!1)}}),getOption:e})},I=s=>({label:`№ ${s.Number}, ${s.ShortAddress}`,value:`№ ${s.Number}, ${s.ShortAddress}`}),M=s=>{var t;const e=s.getOption||I;return new $({root:s.root,apiKey:s.apiKey,button:{text:s.button.text},input:{name:s.input.name,placeholder:s.input.placeholder},placeholder:{text:((t=s==null?void 0:s.placeholder)==null?void 0:t.text)||"Нічого не знайдено."},onMounted:n=>p(exports,null,function*(){var i;if(s.city){n.setLoading(!0);const l=yield n.api.getNpWarehouses(s.city);n.setOptions(l),n.setLoading(!1),n.setOpen(!0)}(i=s.onMounted)==null||i.call(s,n)}),onSelect:(n,i)=>p(exports,null,function*(){var l;i.setSelected(n.value),(l=s.onSelect)==null||l.call(s,n,i)}),onInput:(n,i)=>p(exports,null,function*(){const l=i.getOptions();console.log(l,n);const d=O(l,n);console.log(d),i.setFiltered(d)}),onOpen:s.onOpen,getOption:e})},f={validateMultiple:s=>s.map(e=>e.validate()).every(e=>e)};exports.NpCitySelect=_;exports.NpWarehouseSelect=M;exports.utils=f;
